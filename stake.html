
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <link href="https://modfxmarket.com/street/img/street12.PNG" rel="icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STREET MONEY S+S </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3modal@1.9.8/dist/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3modal@1.9.8/dist/index.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-image: url('stars.gif');
            background-repeat: repeat;
            color: #e7dfdd;
        }
        header {
            padding: 10px;
            text-align: center;
        }
        
        
        /* Renk Geçişi Animasyonu */
@keyframes gradient-flow {
    0% {
        background-position: 0% 50%;
    }
    50% {
        background-position: 100% 50%;
    }
    100% {
        background-position: 0% 50%;
    }
}

        
       button {
    background-color: #4717f6; /* Mor buton arka planı */
    color: #e7dfdd; /* Açık gri metin rengi */
    border: none;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    position: relative; /* Pseudo-element için gerekli */
    z-index: 1; /* Buton içeriğinin üstte görünmesini sağlar */
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.3); /* Hafif gölge efekti */
    transition: background-color 0.9s ease, transform 0.9s ease; /* Hover ve tıklama efekti */
    }
    

    button:hover {
    background-color: #ff6600; /* Turuncu hover efekti */
    transform: scale(1.05); /* Hover ile hafif bÃ¼yÃ¼me efekti */
    }

    button:before {
     content: "";
    position: absolute;
    top: -1px; /* Çizgiyi butona daha yakın yerleştirir */
    left: -1px;
    right: -1px;
    bottom: -1px;
    border-radius: 8px; /* Buton kenarlarına uyumlu */
    background: linear-gradient(
        90deg,
        #ff0000,
        #ff6600,
        #ff0,
        #0f0,
        #0ff,
        #00f,
        #f0f,
        #ff0000
    );
    background-size: 450% 450%; /* Yumuşak geçiş */
    z-index: -1; /* Pseudo-elementi butonun arkasına taşır */
    pointer-events: none; /* Tıklamaları engellemez */
    border: 0.5px solid transparent; /* Çizgi kalınlığı */
    animation: gradient-flow 50s linear infinite; /* Renk geçişi animasyonu */
}    
}

/* Renk Geçişi Animasyonu */
@keyframes gradient-flow {
    0% {
        background-position: 0% 50%;
    }
    50% {
        background-position: 100% 50%;
    }
    100% {
        background-position: 0% 50%;
    }
}
        
        
    button:active {
    background-color: #cc5200; /* Daha koyu turuncu tÄ±klama efekti */
    transform: scale(1); /* TÄ±klamayla geri dÃ¶nÃ¼ÅŸ */
    }

        h5, h3 {
            color: #ff6600;
        }
        p {
            color: #e7dfdd;
        }
        .container {
            margin-top: 20px;
        }
        .card {
            margin-bottom: 20px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.09);
        }
        .token-icon {
        width: 150px; /* Genişlik 150px */
        height: 150px; /* Yükseklik 150px */

    }
    
    
    </style>
</head>
<body>

<header>
    <center>
        <img class="token-icon" src="https://modfxmarket.com/street/img/street12.PNG">
    </center>
    <center>
       AVAX-CCHAIN FUJI TEST TOKEN KONTRAT <br> 
       0xBD9390D51a95a0A4DF671fa837cED0B34e4b7E29
    </center>
</header>

<div class="container">
    <!-- Cüzdan Bağlantısı -->
    <div class="card">
        <div class="card-body text-center">
            <button id="connectWallet" class="button">Cüzdanı Bağla</button>
            <p id="walletAddress" class="mt-3 text-muted">Henüz bir cüzdan bağlanmadı.</p>
        </div>
    </div>

    <!-- STREET Bakiye Görüntüleme -->
    <div class="card">
        <div class="card-body">
            <h5>STREET Bakiye:</h5>
            <p id="streetBalance">Henüz bağlı değil</p>
        </div>
    </div>

    <!-- Stake Etme -->
    <div class="card">
        <div class="card-body">
            <h5>STREET Stake Et:</h5>
            <form id="stakeForm">
                <div class="form-group">
                    <input type="number" id="stakeAmount" class="form-control" placeholder="Stake edilecek STREET miktarı" required>
                </div>
                <button type="submit" class="button">Stake Et</button>
            </form>
        </div>
    </div>

    <!-- Stake Bilgileri ve Geri Sayım -->
    <div class="card">
        <div class="card-body">
            <h5>Stake Edilen STREET Tokenlar:</h5>
            <p id="stakedTokens">Henüz stake edilen token yok</p>
            <h5>Kazanılan Ödüller:</h5>
            <p id="earnedRewards">0 STREET</p>
            <h5>Stake Bitiş Tarihi:</h5>
            <p id="countdown">Henüz stake edilmedi</p>
            <button id="unstakeTokens" class="button" disabled>Unstake Et</button>
        </div>
    </div>
</div>

<script>
    let web3, provider, userAddress, interval, countdownInterval;
    const rewardRate = 0.05; // %5 ödül oranı
    const rewardInterval = 30 * 24 * 60 * 60; // 30 gün
    const contractAddress = "0xBD9390D51a95a0A4DF671fa837cED0B34e4b7E29";

    // Web3Modal Kurulumu
    const web3Modal = new Web3Modal.default({
        cacheProvider: false,
        providerOptions: {
            walletconnect: {
                package: WalletConnectProvider.default,
                options: {
                    rpc: {
                        43113: "https://api.avax-test.network/ext/bc/C/rpc",
                    },
                },
            },
        },
    });
    

    // Cüzdan Bağlama
    document.getElementById("connectWallet").addEventListener("click", async () => {
        try {
            provider = await web3Modal.connect();
            web3 = new Web3(provider);

            const accounts = await web3.eth.getAccounts();
            userAddress = accounts[0];
            document.getElementById("walletAddress").textContent = `Bağlı Cüzdan: ${userAddress}`;
            await updateBalanceAndStake();
        } catch (error) {
            console.error("Cüzdan bağlanırken hata oluştu:", error);
        }
    });
    
    
     // Stake İşlemi
    document.getElementById("stakeForm").addEventListener("submit", async (event) => {
        event.preventDefault();
        const amount = document.getElementById("stakeAmount").value;
        if (!amount || amount <= 0) return alert("Geçerli bir miktar giriniz.");

        try {
            const streetContract = new web3.eth.Contract([
                { "inputs": [{ "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "stakeTokens", "outputs": [], "stateMutability": "nonpayable", "type": "function" }
            ], "0xBD9390D51a95a0A4DF671fa837cED0B34e4b7E29"); // Kontrat adresinizi buraya ekleyin.

            await streetContract.methods.stakeTokens(web3.utils.toWei(amount)).send({ from: userAddress });
            alert("Stake işlemi başarılı!");

            await updateBalanceAndStake();
        } catch (error) {
            console.error("Stake işlemi sırasında hata:", error);
        }
    });
    

    // Bakiye ve Stake Bilgilerini Güncelle
    async function updateBalanceAndStake() {
        try {
            const streetContract = new web3.eth.Contract([
                { "constant": true, "inputs": [{ "name": "owner", "type": "address" }], "name": "balanceOf", "outputs": [{ "name": "", "type": "uint256" }], "type": "function" },
                { "constant": true, "inputs": [{ "name": "staker", "type": "address" }], "name": "stakes", "outputs": [{ "name": "amount", "type": "uint256" }, { "name": "timestamp", "type": "uint256" }], "type": "function" }
            ], contractAddress);

            const balance = await streetContract.methods.balanceOf(userAddress).call();
            document.getElementById("streetBalance").textContent = `${web3.utils.fromWei(balance)} STREET`;

            const stakedTokens = await streetContract.methods.stakes(userAddress).call();
            if (stakedTokens.amount > 0) {
                document.getElementById("stakedTokens").textContent = `${web3.utils.fromWei(stakedTokens.amount)} STREET`;

                const stakeEndTime = parseInt(stakedTokens.timestamp) + rewardInterval;
                startCountdown(stakeEndTime);
                calculateRewards(stakedTokens.amount, stakedTokens.timestamp);
                document.getElementById("unstakeTokens").disabled = false;
            } else {
                document.getElementById("countdown").textContent = "Henüz stake edilmedi";
                document.getElementById("earnedRewards").textContent = "0 STREET";
                document.getElementById("unstakeTokens").disabled = true;
            }
        } catch (error) {
            console.error("Bilgiler alınırken hata:", error);
        }
    }

    // Ödülleri Hesapla
    function calculateRewards(amount, timestamp) {
        clearInterval(interval);
        interval = setInterval(() => {
            const now = Math.floor(Date.now() / 1000);
            const stakingDuration = Math.min(now - timestamp, rewardInterval);
            const rewards = (stakingDuration / rewardInterval) * rewardRate * web3.utils.fromWei(amount);
            document.getElementById("earnedRewards").textContent = `${rewards.toFixed(4)} STREET`;
        }, 1000);
    }

    // Geri Sayım
    function startCountdown(stakeEndTime) {
        clearInterval(countdownInterval);
        countdownInterval = setInterval(() => {
            const now = Math.floor(Date.now() / 1000);
            const timeLeft = stakeEndTime - now;

            if (timeLeft <= 0) {
                clearInterval(countdownInterval);
                document.getElementById("countdown").textContent = "Stake süresi doldu!";
                document.getElementById("unstakeTokens").disabled = false;
                return;
            }

            const days = Math.floor(timeLeft / (24 * 60 * 60));
            const hours = Math.floor((timeLeft % (24 * 60 * 60)) / (60 * 60));
            const minutes = Math.floor((timeLeft % (60 * 60)) / 60);
            const seconds = timeLeft % 60;

            document.getElementById("countdown").textContent = `${days}g ${hours}s ${minutes}dk ${seconds}sn`;
        }, 1000);
    }
</script>

</body>
</html>
